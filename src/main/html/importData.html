<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8" />
   <title>Import Data</title>
   <script src="../javascript/prototype.js"></script>
   <style>
      body {
         padding-left: 10px;
         padding-bottom: 150px;
      }
   </style>
   <script>
      'use strict';

      function convert()
      {
         var output = {};
         var input = document.getElementById('input').value;
         if (input.contains('\t')) input = '"' + input.replace(/\t/g, '","') + '"';
         var rowList = input.split('\r?\n');
         for (var rawRow of rowList)
         {
            var row = JSON.parse('[' + rawRow + ']');
            if (0 === row.length) continue;
            var className = row[0], initializeClass = false;
            if (undefined === output[className])
            {
               output[className] = {
                  statsMultiplier: {},
                  psynergy: [],
                  requirements: {}
               };
               initializeClass = true;
            }
            var classData = output[className];
            //1: adept, 2: Combat Type
            if (undefined === classData.requirements[row[1]]) classData.requirements[row[1]] = {};
            classData.requirements[row[1]][row[2]] = {
               "earth": Number.parseInt(row[3]),
               "fire": Number.parseInt(row[4]),
               "wind": Number.parseInt(row[5]),
               "ice": Number.parseInt(row[6])
            };
            if (initializeClass)
            {
               classData.statsMultiplier = {
                  "hp": Number.parseFloat(row[7]),  //Number.parseFloat ignores tailing %
                  "pp": Number.parseFloat(row[8]),
                  "attack": Number.parseFloat(row[9]),
                  "defense": Number.parseFloat(row[10]),
                  "agility": Number.parseFloat(row[11]),
                  "luck": Number.parseFloat(row[12])
               };
               var psynergyList = row.slice(13);
               for (var i = 0; (i + 1) < psynergyList.length; i += 2)
               {
                  classData.psynergy.push({level: Number.parseInt(psynergyList[i]), name: psynergyList[i + 1]});
               }
            }
         }
         document.getElementById('output').value = JSON.stringify(output);
      }
   </script>
</head>
<body onload="document.getElementById('input').focus();">
<label for="input">Input CSV:</label><br />
<!--"Class","adept","Combat Type","earth","fire","wind","ice","hp","pp","attack","defense","agility","luck","psynergy level learned","psynergy name"-->
<textarea id="input" rows="10" cols="50">
"Apostate","earth","Mage",0,4,4,0,1.7,1.85,1.35,1.35,1.65,0.9,1,"Cure",5,"Quake"
"Apostate","fire","Mage",4,0,4,0,1.7,1.85,1.35,1.35,1.65,0.9,1,"Cure",5,"Quake"
</textarea><br />
<input type="button" value="Convert" onClick="convert()" /><br />
<label for="output">Output JSON:</label><br />
<textarea id="output" rows="10" cols="50"></textarea>
</body>
</html>
